# ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã§IPç¯€ç´„
![fig1](./fig1.png)
(ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã ã¨è¦‹ã¥ã‚‰ã„ã®ã¯æ°—ã®ã›ã„ã§ã™ã€‚)

ã¨ã„ã†ã“ã¨ã§ã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ä½¿ã£ã¦æ¥µåŠ›IPæ¸›ã‚‰ã—ã¾ã—ãŸã€‚

> [!note]
> ã“ã®è¨˜äº‹ã¯ã€ã¨ã‚ã‚‹ç†ç”±ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«IPãªã©ç‰¹å®šã®IPï¼ˆä»¥ä¸‹ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã¨ã„ã†ï¼‰ã®å‰²ã‚Šå½“ã¦ã‚’æ¸›ã‚‰ã—ãŸã„äººå‘ã‘ã«æ›¸ã„ã¦ãŠã‚Šã¾ã™ã€‚  
> è‡ªå®…ãªã©ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¯€ç´„ã«ã¤ã„ã¦ã¯æ›¸ã„ã¦ãŠã‚Šã¾ã›ã‚“ã€‚  
> 
> ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«IP(/32)ã‚’ã†ã¾ãä½µç”¨ã™ã‚Œã°ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚’ç¯€ç´„ã—ã¤ã¤ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹æˆã§ãã¾ã™ã€‚
> 
> æœ¬è¨˜äº‹ã§ã¯ã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„/32, /31ã®ä½¿ã„æ–¹ã«åŠ ãˆã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã¨ã®ä½µç”¨ã«ã‚ˆã‚‹IPç¯€ç´„ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## çµè«–1
![fig2](./fig2.png)

`/32`ã¨`/31`ã‚’ä½¿ã†ã¨ç„¡é§„ãªIPãŒæ¸›ã‚Šã¾ã™ï¼

### ç„¡é§„ãªIPã£ã¦ï¼Ÿ
ã“ã“ã§ã¯ã€ç„¡é§„ãªIPã¨ã¯ã€æ¬¡ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã“ã¨ã‚’è¨€ã†ã€‚

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹
- ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹

ãŠã„ãŠã„ã¾ã¦ã‚ˆã€äºŒã¤ã¨ã‚‚æœ¬å½“ã«ä¸è¦ãªã®ã‹ã„ï¼Ÿ  
ã¨æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ ã¾ãã¶ã£ã¡ã‚ƒã‘ä¸è¦ã˜ã‚ƒã­ï¼ŸçŸ¥ã‚‰ã‚“ã‘ã©ã€‚

ã¨ã«ã‹ãã“ã®äºŒã¤ã¯æ©Ÿæã«ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹ã“ã¨ã‚‚ã§ããªã„ã—ã€  
æ©Ÿæã«ã‚¢ã‚µã‚¤ãƒ³ã§ããªã„ã£ã¦ã“ã¨ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ä½¿ãˆã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã˜ã‚ƒãªã„ã—

> [!WARNING]  
> ç§ã¯ãŸã¾ã«é©å½“ãªã“ã¨è¨€ã„ã¾ã™ã€æ°—ã«ãªã£ãŸã‚‰èª¿ã¹ã¦ã»ã—ã„

### ã˜ã‚ƒã‚æ¶ˆãã†ï¼ã¨ã¯ã„ã‹ãªã„
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹æˆã™ã‚‹ã«ã¯ã€RFCã¨ã„ã†ãŠç´„æŸã«ã‚ˆã‚Šã€
ä¸Šè¨˜äºŒã¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä¸€éƒ¨ã®ä¾‹å¤–ã‚’é™¤ã„ã¦å¿…ãšç™ºç”Ÿã—ã¦ã—ã¾ã†ã®ã§ã™

### ç„¡é§„ãªIPãŒæ¶ˆãˆã‚‹ä¾‹å¤–ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
ãã‚‚ãã‚‚ä¾‹å¤–ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ã¾ãšã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨è¨€ã£ã¦ã„ã„ã®ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚  
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã£ã¦è¤‡æ•°ã®æ©Ÿæã‚’ç¹‹ã’ã‚ã†æŠ€è¡“ã§ã—ã‚‡ã†ï¼Ÿ

#### ä¾‹å¤–1: /31 ä¸€å¯¾ä¸€ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼é–“ã‚’ä¸€å¯¾ä¸€ã§ç¹‹ã’ã‚‹å ´åˆã¯ã€/30ã¨/31ãŒç”¨ã„ã‚‰ã‚Œã¾ã™ã€‚  
ã“ã®ã†ã¡ã€/30ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“çš„ã«4ã¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹(32-30=2[bit]=4é€šã‚Š)å‰²ã‚ŠæŒ¯ã‚Œã¦ã€  
/31ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“çš„ã«2ã¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹(32-31=1[bit]=2é€šã‚Š)å‰²ã‚ŠæŒ¯ã‚Œã¾ã™ã€‚

ã—ã‹ã—ã€ç„¡é§„ãªã‚¢ãƒ‰ãƒ¬ã‚¹äºŒã¤ã‚’å‰²ã‚ŠæŒ¯ã‚ã†ã¨ã™ã‚‹ã¨ã€  
/30ã§ä½¿ãˆã‚‹å®Ÿéš›ã«ä½¿ãˆã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯2ã¤ã«ãªã‚Šã€
/31ã«è‡³ã£ã¦ã¯0ã«ãªã‚Šã¾ã™ã€‚

å®Ÿã¯ã“ã“ã§ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã™ã€‚/31ã®ã‚ˆã†ã«ã€ç„¡é§„ãªIPã«ã‚ˆã£ã¦å®Ÿéš›ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒ0ã«ãªã‚‹å ´åˆã€
ç„¡é§„ãªã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç™ºç”Ÿã—ãªããªã‚‹ã®ã§ã™ã€‚

ã™ãªã‚ã¡ã€/31ã¯äºŒã¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä½¿ç”¨å¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

...å®Ÿã¯ã€/31ã¯é•·å¹´è­°è«–ã•ã‚Œã¦ã„ãŸã‚ˆã†ã§ã€å¤ã„ãƒ«ãƒ¼ã‚¿ãƒ¼ã§ã™ã¨è¨­å®šã§ããªã„ã¿ãŸã„ã§ã™ã€‚

#### ä¾‹å¤–2: /32 ä¸€ã¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹
/32ã¯ã‚‚ã¯ã‚„ã‚¢ãƒ‰ãƒ¬ã‚¹ä¸€ã¤ã‚’æŒ‡ã—ã¾ã™ã€‚ã€€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹æˆã§ãã¾ã›ã‚“ã€‚
/31ã®æ™‚ã®ã‚ˆã†ã«ã€ä¾‹å¤–ãŒç™ºå‹•ã—ã¾ã™ã€‚

/32ã®ç”¨é€”ã¯ã“ã®ã‚ã¨ä¾‹ã«æŒ™ã’ã¾ã™ãŒã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹æˆã™ã‚‹å¿…è¦ãŒãªã„ã€è‡ªåˆ†è‡ªèº«ã‚’ç¤ºã™éš›ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

#### ä¾‹å¤–ã¾ã¨ã‚
ãã‚‚ãã‚‚ä¾‹å¤–ã¨è¨€ã£ã¦ã¾ã™ã‘ã©ã€äºŒã¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ„å‘³ã‚’è€ƒãˆã‚‹ã¨
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹  
  /32ã¯ãã‚‚ãã‚‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã‚‚ã„ãˆãªã„   
  /31ã¯è¨­å®šã™ã‚‹ä½™è£•ãŒãªã„
- ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹  
  /31ã‚‚/32ã‚‚ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒãªã„

ã¨ã„ã†ã“ã¨ã§ã€å¿…è¦ãŒãªããªã‚‹ã¨ã„ã†ã‚ã‘ã§ã™ã€‚

### çµè«–1ã¾ã¨ã‚

![fig2](./fig2.png)

å†’é ­ã«ã‚‚ã‚ã‚‹ã“ã®å›³ã®ã‚ˆã†ã«ã€/31ã¨/32ã‚’ä½¿ãˆã°ã€éš…ã€…ã«ã¾ã§ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

## çµè«–2

![fig3](./fig3.png)

ã“ã£ã¡ã¯ç°¡å˜ã§ã™ã€‚  

å†’é ­ã®ãƒãƒ¼ãƒˆã«è¿°ã¹ãŸé€šã‚Šã€**åŸºæœ¬ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚’ä½¿ç”¨ã—ã¤ã¤ã€/32ã§å‰²ã‚Šå½“ã¦å¯èƒ½ãªãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ã†ã“ã¨ã§IPã‚’ç¯€ç´„ã—ã¾ã™ã€‚**

ãã®ã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã§é€šä¿¡ã™ã‚‹æ–¹æ³•ã§ã™ãŒã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¸Šæµãƒ«ãƒ¼ã‚¿ãƒ¼ã«çµŒè·¯é€šçŸ¥ã™ã‚Œã°ã€é€šä¿¡ãŒå¯èƒ½ã«ãªã‚‹ã£ã¦ã“ã¨ã§ã™ã€‚  

> [!WARNING]  
> æ‡¸å¿µç‚¹ã‚’æŒ™ã’ã‚‹ã¨ã™ã‚Œã°ã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã—ãŸæ©Ÿæã‹ã‚‰ã¯ã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ã£ã¦å¤–ã«å‡ºã‚‹ã‚ˆã†ã«ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ã§ã™ã€‚ å›³ã«ã‚‚é»„è‰²è›å…‰ãƒšãƒ³ã§å¼·èª¿ã•ã›ã¦ã¾ã™ãŒã€ãƒ‘ã‚±ãƒƒãƒˆã®srcãŒloopbackã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚‚ã®ã«ãªã‚‰ãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚  
>
> **ã“ã®è¨­å®šãŒå¯èƒ½ã§ãªã„ã¨ã€ã“ã®æ‰‹æ³•ã¯ã¨ã‚Œãªã„ã“ã¨ã«ãªã‚Šã¾ã™**ã€‚


### netplanã®å ´åˆ
netplanã®å ´åˆã¯routesã®ä¸­ã§**from**ãŒä½¿ãˆã¾ã™ã€‚ã€€ã“ã‚Œã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€loã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ãƒ‘ã‚±ãƒƒãƒˆãŒé€å‡ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```yaml
network:
  version: 2
  ethernets:
    lo:
      addresses:
        - 10.1.1.1/32
    enp1s0:
      dhcp4: false
      dhcp6: false
      accept-ra: false
      addresses:
        - 10.0.0.2/24
      routes:
        - to: default
          via: 10.0.0.1
          from: 10.1.1.1
      nameservers:
        addresses:
          - 8.8.8.8
          - 8.8.4.4
```

### /31ã¯ã‚ã¾ã‚Šæ„å‘³ãŒãªã„
L3ã‚¹ã‚¤ãƒƒãƒãªã©ã®ãƒãƒ¼ãƒˆã”ã¨ã«1ã¤ã€ã•ã‚‰ã«ç›¸æ‰‹å´ï¼ˆä»®æƒ³ã‚µãƒ¼ãƒãƒ¼ãªã©ï¼‰ã«ã‚‚1ã¤IPã‚’å‰²ã‚Šå½“ã¦ã‚‹å¿…è¦ãŒã‚ã‚Šã€çµå±€2ã¤æ¶ˆè²»ã—ã¾ã™ã€‚
ä¸€æ–¹ã€/32ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPï¼ˆä¾‹ãˆã° 192.168.x.x ãªã©ï¼‰ã‚’ä½µç”¨ã™ã‚Œã°ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã¯æ¯æ¸‡ã—ã«ãã„ã®ã§ã€  
L3ã‚¹ã‚¤ãƒƒãƒå´ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚’å‰²ã‚Šå½“ã¦ã€ç›¸æ‰‹å´ã®ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª/32ã‚’å‰²ã‚Šå½“ã¦ã‚Œã°æ¸ˆã¿ã¾ã™ã€‚

è¦ã™ã‚‹ã«ã€/32ï¼‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã§ã‚„ã‚‰ãªã„ã¨IPç¯€ç´„ã«ã¤ãªãŒã‚‰ãªã„ã®ã§ã™ã€‚
(ä¸€ã¤ã®ã‚µãƒ¼ãƒãƒ¼ã§è¤‡æ•°ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚’ä½¿ã„ãŸã„ãªã‚‰åˆ¥)

# ã¾ã¨ã‚
ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„/32ã®æ´»ç”¨ã€ãã—ã¦ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã¨ã®ä½µç”¨ã«ã‚ˆã£ã¦ã€  
ç„¡é§„ãªã‚°ãƒ­ãƒ¼ãƒãƒ«IPæ¶ˆè²»ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚IPæ¯æ¸‡å¯¾ç­–ã®ä¸€æ¡ˆã¨ã—ã¦ã”å‚è€ƒã¾ã§ï¼

...ã¨ã„ã†ä»Šæ›´ã®è©±é¡Œã§ã—ãŸã€‚

> **ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã¯ã‚±ãƒã£ã¦ãƒŠãƒ³ãƒœã€‚ä½™ã£ãŸåˆ†ã§ãƒ“ãƒ¼ãƒ«ã§ã‚‚é£²ã¿ã¾ã—ã‚‡ã†ğŸº**

# å‚è€ƒ
- [Netplan documentation(routing)](https://netplan.readthedocs.io/en/stable/netplan-yaml/#routing)